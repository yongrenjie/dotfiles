set number
set autoindent
filetype off
syntax on
set lines=30 columns=120
set guifont=Meslo\ LG\ S:h9w6
set backspace=indent,eol,start
set ignorecase
set smartcase
set mouse=c " disable mouse

" Leader key
nnoremap <Space> <Nop>
let mapleader=" "

function ExpandDOIBib()
    let doi = expand("<cWORD>")
    normal! diW
    execute 'r !doi2biblatex.py' doi
    normal! =ap}{dd
    " Edge case where it produces an extra line
    if line(".") == 1
        if getline(".") !~ '\S'
            normal! dd
        endif
    endif
endfunction

function! OpenDOIURL()
    let firstline = line("'{")
    let lastline = line("'}")
    let i = firstline
    while i <= lastline
        let tline = getline(i)
        let doi = matchstr(tline, 'doi\s*=\s*{\s*\zs.*\ze\s*}')
        if !empty(doi)
            execute "OpenURL https://doi.org/" . doi
            break
        endif
        let i = i + 1
    endwhile
endfunction

nnoremap <leader>ex :call ExpandDOIBib() <CR>
nnoremap <leader>op :call OpenDOIURL() <CR>

" Easy system clipboard yank/paste
vnoremap ;;p "*p
vnoremap ;;P "*P
vnoremap ;;y "*y
vnoremap ;;Y "*Y
nnoremap ;;p "*p
nnoremap ;;P "*P
nnoremap ;;y "*y
nnoremap ;;Y "*Y

" required for Vundle
let &shell='cmd.exe'
set rtp+=~/.vim/bundle/Vundle.vim/
call vundle#begin('$HOME/.vim/bundle')
Plugin 'VundleVim/Vundle.vim'
" nice colour schemes
Plugin 'dikiaap/minimalist'
"call vundle#config#require(g:bundles)
Plugin 'NLKNguyen/papercolor-theme'
" MATLAB syntax highlighting
Plugin 'raingo/vim-matlab'
" Python syntax highlighting
Plugin 'yongrenjie/python-syntax'
" LaTeX support
Plugin 'lervag/vimtex'
" HTML support
Plugin 'mattn/emmet-vim'
" Other stuff
Plugin 'wellle/targets.vim'
Plugin 'tpope/vim-surround'
Plugin 'tpope/vim-fugitive'
Plugin 'tpope/vim-commentary'
Plugin 'dhruvasagar/vim-open-url'
let g:python_highlight_all=1
let g:python_highlight_space_errors=0
call vundle#end()

filetype plugin indent on
set t_Co=256
set background=dark
colorscheme PaperColor
set shiftwidth=4
set tabstop=4
set expandtab

" Correct indent style for SE citation manager
:au BufEnter ~/citation/*.js :set expandtab!

" Correct indent style for TopSpin Python programmes
:au BufEnter ~/ps-opt/ts/*.py :set expandtab!
:au BufEnter ~/ps-opt/ts/*.py :set ts=8
:au BufEnter ~/ps-opt/ts/*.py :set sw=8
